# Fund Administration
Fund administration pallet allows the creation of multiple projects and manages their funds. 
- [Fund Administration](#fund-administration)
  - [Overview](#overview)
    - [Terminology](#terminology)
  - [Interface](#interface)
    - [Dispachable functions](#dispachable-functions)
    - [Getters](#getters)
    - [Constants](#constants)
  - [Usage](#usage)
    - [Polkadot-js CLI](#polkadot-js-cli)
    - [](#)
  - [Events](#events)


## Overview

This module provides functionality to handle the project creation and fund management, as well as the following actions:
- The creation of multiple projects with a unique identifier.
- Register users with a specific role 
- Add or remove project participants. Each participant has a specific role in the project, roles are:   `Administrator`, `Builder`, `Investor`, `Issuer` and `RegionalCenter`.
- The creation of multiple budget expenditures to keep track of expenses. Each budget expenditure needs a NAICS code and Jobs Multiplier to calculate the number of jobs created.
- Modify the inflation rate of a project for the selected year. 
- Keeps a record of the transactions made in a drawdown
- Keeps a record of the transactions made in a drawdown

### Terminology

- **Project:** Is the small unit of work, it is identified by a `ProjectID`. Once a project has been created, it is possible to assign or remove users, perform transactions, etc.
- **Inflation rate:** Is the rate of increase in the money supply of a country.
- **User**: Is the person who is registered in the system, it can be an administrator, builder, investor, issuer or regional center.
- **Proxy Role**: Is the role that a user has in a project, depending on the role, the user will have different permissions.
- **Permission**: Is the ability to perform a specific action.
- **Project status**: Is the status of a project, it can be `Started` or `Completed`.
- **Document**: Is the document that is uploaded to the system while performing a transaction.
- ** Expenditure type**: Budget expenditure types are: `HardCost`, `SoftCost`, `Operational` & `Others`.
- **Bulk upload documents**: For Construction Loan & Develor Equity drawdowns, the builder uploads the required documents in bulk. Later, the administrator can review the documents and approve or reject them.
- **CUDAction**: Is the acronym for `Create`, `Update` or `Delete`, it is used to classify the type of action that is performed.
- **AssignAction**: Is used to `Assign` or `Unassign` a user to a project.
- **Transaction**: Is the smalles actions that is performed in a drawdown or a revenue, always requires a CUDAction.
- **Feedback**: Is the reason why a transaction or drawdown is rejected.
- **Builder**: Fund administration role who is responsible to issue drawdowns.
- **Investor**: EB-5 investors are foreign nationals who invest capital into a US operation, typically either a real estate project or operating business, in order to gain certain immigration benefits such as conditional residency, commonly known as a green card.
- **Administrator**: Tracks project performance and serves as an overseer of the flow of funds from the Issuer to the Builder.
- **Issuer**: The Issuer collects capital from the investors and the Builder then requests that capital so the money can be spent on building the project. 
- **Regional Center**:  An EB-5 regional center is an economic unit, public or private, in the United States that is involved with promoting economic growth. One of the ways they do so is sponsoring real estate projects that are financed by capital from foreign EB-5 investors.
- **Drawdown**: In the world of real estate development there are typically two entities involved. The fund entity (the Issuer) and the project entity (the Builder). The Issuer collects capital from the investors and the Builder then requests that capital so the money can be spent on building the project. This is done through a drawdown request. The Builder issues a drawdown request to the Issuer who then releases the money to the Builder assuming all requirements are met. That movement of funds is called a Drawdown.
- **Revenue**: Works similar to a drawdown, but is used to track incomes generated by the project.
- **Budget Expenditure**: A budget expenditure is the Builder paying funds needed to build the project. A payment from the Builder to a construction contractor is an example of a Budget Expenditure.
- **Job Eligible Revenue**: All EB-5 projects must create American jobs. Some projects, such as hotels as one example, are able to use revenues from operations as a source for calculating jobs created. Not all EB-5 projects have Job Eligible Revenue as some are only able to use expenditures rather than revenue for calculating job creation.
- **NAICS code**: NAICS stands for North American Industry Classification System. It is a system used by the United States government to classify business establishments for the purpose of collecting, analyzing, and publishing statistical data related to the U.S. business economy. NAICS codes are used to classify industries. The NAICS code is used to calculate the number of jobs created by a project.
- **Jobs Multiplier**: Indicate how important an industry is in regional job creation. The multiplier is used to calculate the number of jobs created by a project.
## Interface

### Dispachable functions
- `initial_setup` initializes the pallet by setting the permissions for each role
& creates the global scope
- `sudo_add_administrator` adds a new administrator to the system, requires the sudo key. It's the only way to register the first administrator.
- `sudo_remove_administrator` removes an administrator from the system, requires the sudo key. It's the only way to remove the first administrator. 
- `users` allows to create, update or delete a user account from the system. Only administrators can perform this action.
- `users_edit_user` allows to edit the user informaction (name, email, etc). Any registered user can perform this action.
- `projects_create_project` creates a new project instance, only administrators can perform this action. During the project creation, the administrator can create budget expenditures, job eligibles & assign users to the project. 
- `projects_edit_project` edits the information of the selected project (title, description, image, etc). It also allwos administrators to modify the project creation date & completion date (remeber that completion date must be greater than creation date).Projects can only be edited if they are in `Started` status.
- `projects_delete_project` deletes a project instance, only administrators can perform this action. Deleting a project will also delete ALL stored data related to the project. BE CAREFUL!
- `projects_assign_user` assigns or unassigns a user to a project, only administrators can perform this action. Before assigning a user to a project, the user must be registered in the system. Users can only have one role per project.
- `expenditures_and_job_eligibles` allows to create, update or delete a budget expenditure or a job eligible. Multiple CUDActions can be performed at the same time, but not over the same budget expenditure or job eligible.
- `submit_drawdown` allows to create, update or delete transactions in a drawdown. Multiple CUDActions can be performed at the same time, but not over the same transaction. A drawdown can be submitted only if it has at least one transaction. Exists a draft status for drawdowns, this status allows to save the drawdown without submitting to the administrator.
- `approve_drawdown` approves a drawdown, only administrators can perform this action. All transactions in the drawdown must be right in order to approve the drawdown. Bulkupload drawdows requieres that an administrator fills individual transactions before approving the drawdown.
- `reject_drawdown` rejects a drawdown, only administrators can perform this action. If a single transaction is wrong, the administrator will reject the drawdown. A feedback is required when rejecting a drawdown. After a drawdown is rejected, it can be edited and submitted again.
- `up_bulkupload` allows builders to upload documents in bulk. Documents are uploaded to the system and then the administrator will review them. Bulkupload drawdowns are only allowed for Construction Loan & Developer Equity drawdowns.
- `inflation_rate` modifies the inflation rate of a project for the selected year. Inflation value is used for reporting purposes.
- `submit_revenue` allows to create, update or delete transactions in a revenue. Multiple CUDActions can be performed at the same time, but not over the same transaction. A revenue can be submitted only if it has at least one transaction. Draft status allows to save the revenue without submitting to the administrator.
- `approve_revenue` approves a revenue, only administrators can perform this action. All transactions in the revenue must be right in order to approve the revenue.
- `reject_revenue` rejects a revenue, only administrators can perform this action. If a single transaction is wrong, the administrator will reject the revenue. A feedback is required when rejecting a revenue. After a revenue is rejected, it can be edited and submitted again.
- `bank_confirming_documents` uploads the bank confirmation documents for a given drawdown. Only administrators can perform this action. After a drawdown is approved, the administrator will upload the bank confirmation documents & the drawdown status will change to `Confirmed`.
- `reset_drawdown` resets a selected drawdown to its default status. Drawdown needs to be in `Submitted` status in order to be reseted. It will delete all transactions & documents related to the drawdown. Be careful!
- `Kill storage` deletes all the data stored in the pallet. Requires the sudo key. Be careful!

### Getters

|Name| Type | Description |
|--|--|--|
| `global_scope` | StorageValue | Returns the global scope |
| `users_info` | StorageMap | Returns the user information |
| `projects_info` | StorageMap | Returns the project information |
| `users_by_project`| StorageMap | Returns the users assigned to a project |
| `projects_by_user` | StorageMap | Returns the projects assigned to a user |
| `expenditures_info` | StorageMap | Returns the budget expenditure information |
| `expenditures_by_project` | StorageMap | Returns the budget expenditures by project |
| `drawdowns_info` | StorageMap | Returns the drawdown information |
| `drawdowns_by_project` | StorageMap | Returns the drawdowns by project |
| `transactions_info` | StorageMap | Returns the transaction information |
| `transactions_by_drawdown` | DoubleStorageMap | Returns the transactions by drawdown |
| `job_eligibles_info` | StorageMap | Returns the job eligible information |
| `job_eligibles_by_project` | StorageMap | Returns the job eligibles by project |
| `revenues_info` | StorageMap | Returns the revenue information |
| `revenues_by_project` | StorageMap | Returns the revenues by project |
| `revenue_transactions_info` | StorageMap | Returns the revenue transaction information |
| `transactions_by_revenue` | DoubleStorageMap | Returns the revenue transactions by revenue |

### Constants
Constants are used to limit the number of elements that can be created in the system. They are declared in the `pallets/fund-admin/src/lib.rs` file and its value can be modified in the `runtime/src/lib.rs` file. The following constants are available:

- `MaxDocuments`: Maximun number of documents that can be uploaded to the system within a single extrinsic call.

- `MaxProjectsPerUser`: Maximun number of projects that can be assigned to a user.

- `MaxUserPerProject`: Maximun number of users that can be assigned to a project.

- `MaxBuildersPerProject`: Maximun number of builders that can be assigned to a project.

- `MaxInvestorsPerProject`: Maximun number of investors that can be assigned to a project.

- `MaxIssuersPerProject`: Maximun number of issuers that can be assigned to a project.

- `MaxRegionalCenterPerProject`: Maximun number of regional centers that can be assigned to a project.

- `MaxDrawdownsPerProject`: Maximun number of drawdowns that can be created for a project.

- `MaxTransactionsPerDrawdown`: Maximun number of transactions that can be created for a drawdown.

- `MaxRegistrationsAtTime`: Maximun number of users that can be registered at the same time.

- `MaxExpendituresPerProject`: Maximun number of budget expenditures that can be created for a project.

- `MaxProjectsPerBuilder`: Maximun number of projects that can be assigned to a builder.

- `MaxProjectsPerInvestor`: Maximun number of projects that can be assigned to an investor.

- `MaxProjectsPerIssuer`: Maximun number of projects that can be assigned to an issuer.

- `MaxProjectsPerRegionalCenter`: Maximun number of projects that can be assigned to a regional center.

- `MaxBanksPerProject`: Maximun number of banks that can be assigned to a project.

- `MaxJobEligiblesByProject`: Maximun number of job eligibles that can be created for a project.

- `MaxRevenuesByProject`: Maximun number of revenues that can be created for a project.

- `MaxTransactionsPerRevenue`: Maximun number of transactions that can be created for a revenue.

- `MaxStatusChangesPerDrawdown`: Maximun number of status changes that can be performed for a drawdown.

- `MaxStatusChangesPerRevenue`: Maximun number of status changes that can be performed for a revenue.

## Usage

The following examples will be using these prefunded accounts and testing data:

```bash
# Alice's public address 
"5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY"

# Bob's public address
"5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty"

# Charlie's public address
"5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y"

# Dave's public address
"5DAAnrj7VHTznn2AWBemMuyBwZWs6FNFjdyVXUeYum3PTXFy"
```


### Polkadot-js CLI

### 

## Events
```rust
ProxySetupCompleted,
/// Project was created successfully
ProjectCreated(T::AccountId, ProjectId)

/// The selected roject was edited successfully
ProjectEdited(T::AccountId, ProjectId)

/// The selected project was deleted successfully
ProjectDeleted(T::AccountId, ProjectId)

/// Administrator was registered successfully using the sudo pallet
AdministratorAssigned(T::AccountId)

/// Administrator was removed successfully using the sudo pallet
AdministratorRemoved(T::AccountId)

/// The user was assigned to the selected project
UserAssignmentCompleted(T::AccountId, ProjectId)

/// The user was unassigned to the selected project
UserUnassignmentCompleted(T::AccountId, ProjectId)

/// Users extrinsic was executed, individual CUDActions were applied
UsersExecuted(T::AccountId)

/// A new user account was created successfully
UserCreated(T::AccountId)

/// The selected user was edited successfully
UserUpdated(T::AccountId)

/// The selected user was deleted successfully
UserDeleted(T::AccountId)

/// An array of expenditures was executed depending on the CUDAction
ExpendituresExecuted(T::AccountId, ProjectId)

/// Expenditure was created successfully
ExpenditureCreated(ProjectId, ExpenditureId)

/// Expenditure was updated successfully
ExpenditureUpdated(ProjectId, ExpenditureId)

/// Expenditure was deleted successfully
ExpenditureDeleted(ProjectId, ExpenditureId)

/// An array of transactions was executed depending on the CUDAction
TransactionsExecuted(ProjectId, DrawdownId)

/// Transaction was created successfully
TransactionCreated(ProjectId, DrawdownId, TransactionId)

/// Transaction was edited successfully
TransactionEdited(ProjectId, DrawdownId, TransactionId)

/// Transaction was deleted successfully
TransactionDeleted(ProjectId, DrawdownId, TransactionId)

/// Assign users extrinsic was completed successfully
UsersAssignationExecuted(T::AccountId, ProjectId)

/// Drawdowns were initialized successfully at the beginning of the project
DrawdownsInitialized(T::AccountId, ProjectId)

/// Drawdown was created successfully
DrawdownCreated(ProjectId, DrawdownId)

/// Drawdown was submitted successfully
DrawdownSubmitted(ProjectId, DrawdownId)

/// Drawdown was approved successfully
DrawdownApproved(ProjectId, DrawdownId)

/// Drawdown was rejected successfully
DrawdownRejected(ProjectId, DrawdownId)

/// Drawdown was cancelled successfully
DrawdownSubmissionCancelled(ProjectId, DrawdownId)

/// Bulkupload drawdown was submitted successfully
BulkUploadSubmitted(ProjectId, DrawdownId)

/// An array of adjustments was executed depending on the CUDAction
InflationRateAdjusted(T::AccountId)

/// An array of job eligibles was executed depending on the CUDAction
JobEligiblesExecuted(T::AccountId, ProjectId)

/// Job eligible was created successfully
JobEligibleCreated(ProjectId, JobEligibleId)

/// Job eligible was updated successfully
JobEligibleUpdated(ProjectId, JobEligibleId)

/// Job eligible was deleted successfully
JobEligibleDeleted(ProjectId, JobEligibleId)

/// Revenue transaction was created successfully
RevenueTransactionCreated(ProjectId, RevenueId, RevenueTransactionId)

/// Revenue transaction was updated successfully
RevenueTransactionUpdated(ProjectId, RevenueId, RevenueTransactionId)

/// Revenue transaction was deleted successfully
RevenueTransactionDeleted(ProjectId, RevenueId, RevenueTransactionId)

/// An array of revenue transactions was executed depending on the CUDAction
RevenueTransactionsExecuted(ProjectId, RevenueId)

/// Revenue was created successfully
RevenueCreated(ProjectId, RevenueId)

/// Revenue was submitted successfully
RevenueSubmitted(ProjectId, RevenueId)

/// Revenue was approved successfully
RevenueApproved(ProjectId, RevenueId)

/// Revenue was rejected successfully
RevenueRejected(ProjectId, RevenueId)

/// Bank's confirming documents were uploaded successfully
BankDocumentsUploaded(ProjectId, DrawdownId)

/// Bank's confirming documents were updated successfully
BankDocumentsUpdated(ProjectId, DrawdownId)

/// Bank's confirming documents were deleted successfully
BankDocumentsDeleted(ProjectId, DrawdownId)
    ```

## Errors
```rust
/// No value was found for the global scope
NoGlobalScopeValueWasFound
/// Project ID is already in use
ProjectIdAlreadyInUse
/// Timestamp was not genereated correctly
TimestampError
/// Completion date must be later than creation date
CompletionDateMustBeLater
/// User is already registered in the site
UserAlreadyRegistered
/// Project was not found
ProjectNotFound
/// Project is not active anymore
ProjectIsAlreadyCompleted
/// Can not delete a completed project
CannotDeleteCompletedProject
/// User is not registered
UserNotRegistered
/// User has been already added to the project
UserAlreadyAssignedToProject
/// Max number of users per project reached
MaxUsersPerProjectReached
/// Max number of projects per user reached
MaxProjectsPerUserReached
/// User is not assigned to the project
UserNotAssignedToProject
/// Can not register administrator role
CannotRegisterAdminRole
/// Max number of builders per project reached
MaxBuildersPerProjectReached
/// Max number of investors per project reached
MaxInvestorsPerProjectReached
/// Max number of issuers per project reached
MaxIssuersPerProjectReached
/// Max number of regional centers per project reached
MaxRegionalCenterPerProjectReached
/// Can not remove administrator role
CannotRemoveAdminRole
/// Can not add admin role at user project assignment
CannotAddAdminRole
/// User can not have more than one role at the same time
UserCannotHaveMoreThanOneRole
/// Expenditure not found
ExpenditureNotFound
/// Expenditure already exist
ExpenditureAlreadyExists
/// Max number of expenditures per project reached
MaxExpendituresPerProjectReached
/// Field name can not be empty
EmptyExpenditureName
/// Expenditure does not belong to the project
ExpenditureDoesNotBelongToProject
/// Drowdown id is not found
DrawdownNotFound
/// Invalid amount
InvalidAmount
/// Documents field is empty
DocumentsIsEmpty
/// Transaction id is not found
TransactionNotFound
/// Transaction already exist
TransactionAlreadyExists
/// Max number of transactions per drawdown reached
MaxTransactionsPerDrawdownReached
/// Drawdown already exist
DrawdownAlreadyExists
/// Max number of drawdowns per project reached
MaxDrawdownsPerProjectReached
/// Max number of status changes per drawdown reached
MaxStatusChangesPerDrawdownReached
/// Can not modify a completed drawdown
CannotEditDrawdown
/// Can not perform any action on a submitted transaction
CannotPerformActionOnSubmittedTransaction
/// Can not perform any action on a approved transaction
CannotPerformActionOnApprovedTransaction
/// Can not perform any action on a confirmed transaction
CannotPerformActionOnConfirmedTransaction
/// Can not perform any action on a submitted drawdown
CannotPerformActionOnSubmittedDrawdown
/// Can not perform any action on a approved drawdown
CannotPerformActionOnApprovedDrawdown
/// Can not perform any action on a confirmed drawdown
CannotPerformActionOnConfirmedDrawdown
/// Transaction is already completed
TransactionIsAlreadyCompleted
/// User does not have the specified role
UserDoesNotHaveRole
/// Transactions vector is empty
EmptyTransactions
/// Transaction ID was not found in do_execute_transaction
TransactionIdNotFound
/// Drawdown can not be submitted if does not has any transactions
DrawdownHasNoTransactions
/// Cannot submit transaction
CannotSubmitTransaction
/// Drawdown can not be approved if is not in submitted status
DrawdownIsNotInSubmittedStatus
/// Transactions is not in submitted status
TransactionIsNotInSubmittedStatus
/// Array of expenditures is empty
EmptyExpenditures
/// Expenditure name is required
ExpenditureNameRequired
/// Expenditure type is required
ExpenditureTypeRequired
/// Expenditure amount is required
ExpenditureAmountRequired
/// Expenditure id is required
ExpenditureIdRequired
/// User name is required
UserNameRequired
/// User role is required
UserRoleRequired
/// Amount is required
AmountRequired
/// Can not delete a user if the user is assigned to a project
UserHasAssignedProjects
/// Can not send a drawdown to submitted status if it has no transactions
NoTransactionsToSubmit
/// Bulk upload description is required
BulkUploadDescriptionRequired
/// Bulk upload documents are required
BulkUploadDocumentsRequired
/// Administrator can not delete themselves
AdministratorsCannotDeleteThemselves
/// No feedback was provided for bulk upload
NoFeedbackProvidedForBulkUpload
/// NO feedback for EN5 drawdown was provided
EB5MissingFeedback
/// Inflation rate extrinsic is missing an array of project ids
InflationRateMissingProjectIds
/// Inflation rate was not provided
InflationRateRequired
/// Inflation rate has been already set for the selected project
InflationRateAlreadySet
/// Inflation rate was not set for the selected project
InflationRateNotSet
/// Bulkupload drawdowns are only allowed for Construction Loan & Developer Equity
DrawdownTypeNotSupportedForBulkUpload
/// Cannot edit user role if the user is assigned to a project
UserHasAssignedProjectsCannotUpdateRole
/// Cannot delete user if the user is assigned to a project
UserHasAssignedProjectsCannotDelete
/// Cannot send a bulkupload drawdown if the drawdown status isn't in draft or rejected
DrawdownStatusNotSupportedForBulkUpload
/// Cannot submit a drawdown if the drawdown status isn't in draft or rejected
DrawdownIsNotInDraftOrRejectedStatus
/// Only investors can update/edit their documents
UserIsNotAnInvestor
/// Max number of projects per builder has been reached
MaxProjectsPerBuilderReached
/// Max number of projects per investor has been reached
MaxProjectsPerInvestorReached
/// Max number of projects per issuer has been reached
MaxProjectsPerIssuerReached
/// Max number of projects per regional center has been reached
MaxProjectsPerRegionalCenterReached
/// Jobs eligibles array is empty
JobEligiblesIsEmpty
/// JOb eligible name is required
JobEligiblesNameIsRequired
/// Job eligible id already exists
JobEligibleIdAlreadyExists
/// Max number of job eligibles per project reached
MaxJobEligiblesPerProjectReached
/// Job eligible id not found
JobEligibleNotFound
/// Jopb eligible does not belong to the project
JobEligibleDoesNotBelongToProject
/// Job eligible name is required
JobEligibleNameRequired
/// Job eligible amount is required
JobEligibleAmountRequired
/// Job eligible id is required
JobEligibleIdRequired
/// Revenue id was not found
RevenueNotFound
/// Transactions revenue array is empty
RevenueTransactionsEmpty
/// Revenue transaction is not in submitted status
RevenueTransactionNotSubmitted
/// Revenue can not be edited
CannotEditRevenue
/// Revenue transaction id already exists
RevenueTransactionIdAlreadyExists
/// Max number of transactions per revenue reached
MaxTransactionsPerRevenueReached
/// Revenue transaction id not found
RevenueTransactionNotFound
/// Revenue transaction can not be edited
CannotEditRevenueTransaction
/// Max number of status changes per revenue reached
MaxStatusChangesPerRevenueReached
/// Can not perform any action on a submitted revenue
CannotPerformActionOnSubmittedRevenue
/// Can not perform any action on a approved revenue
CannotPerformActionOnApprovedRevenue
/// Can not perform any action on a submitted revenue transaction
CannotPerformActionOnApprovedRevenueTransaction
/// Can not perform any action on a approved revenue transaction
CannotPerformActionOnSubmittedRevenueTransaction
/// Revenue amoun is required
RevenueAmountRequired
/// Revenue transaction id is required
RevenueTransactionIdRequired
/// Revenue Id already exists
RevenueIdAlreadyExists
/// Maximun number of revenues per project reached
MaxRevenuesPerProjectReached
/// Can not send a revenue to submitted status if it has no transactions
RevenueHasNoTransactions
/// Revenue is not in submitted status
RevenueIsNotInSubmittedStatus
/// Revenue transaction is not in submitted status
RevenueTransactionIsNotInSubmittedStatus
/// The revenue is not in submitted status
RevenueNotSubmitted
/// Can not upload bank confirming documents if the drawdown is not in Approved status
DrawdownNotApproved
/// Drawdown is not in Confirmed status
DrawdownNotConfirmed
/// Drawdown is not in Submitted status
DrawdownNotSubmitted
/// Can not insert (CUDAction: Create) bank confmirng documents if the drawdown has already bank confirming documents
DrawdownHasAlreadyBankConfirmingDocuments
/// Drawdown has no bank confirming documents (CUDAction: Update or Delete)
DrawdownHasNoBankConfirmingDocuments
/// Bank confirming documents are required
BankConfirmingDocumentsNotProvided
/// Banck confirming documents array is empty
BankConfirmingDocumentsAreEmpty
/// No scope was provided checking if the user has permissions. No applies for administrator users
NoScopeProvided
/// Only eb5 drawdowns are allowed to upload bank documentation
OnlyEB5DrawdownsCanUploadBankDocuments
/// The private group id is empty
PrivateGroupIdIsEmpty
``` 

